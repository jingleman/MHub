<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/css/jquery.mobile.min.css" />
  <script src="/static/js/jquery.min.js"></script>
  <script src="/static/js/jquery.mobile.min.js"></script>
  <title>MHub</title>
</head>
<body>
  <script>
    $(document).ready(function () {
    
      $("a").bind("click", function () {
        var actionsText = $(this).attr("data-actions"),
            actionsArray, actionArray,
            action, paramsArray, paramArray, i, j,
            url = "/app/send", data = {};
        if(actionsText === "") { return; }
        actionsArray = actionsText.split(";");
        actionsArray = actionsArray.slice(0, actionsArray.length - 1);
        for(i=0; i<actionsArray.length; i++) {
            data = {};
            actionArray = actionsArray[i].split(",")
            action = actionArray[0];
            paramsArray = actionArray.slice(1);
            for(j=0; j<paramsArray.length; j++) {
                paramArray = paramsArray[j].split(":");
                data[paramArray[0]] = paramArray[1];
            }
            data["action"] = action;
            $.ajax({"url": url, "data": data});
        }
      });

    });
  </script>
  <pre>
    {{ menu }}
  </pre>
  <div data-role="page" id="home" class="type-home">
    <div data-role="header">
      <h1>MHub</h1>
    </div>
    <div data-role="content">
      <ul data-role="listview" class="root">
        {%- for item in menu recursive %}
          <li>
            <a data-actions="{%- for action in item.actions %}{{ action.action|escape }}{%- for key in action.params %},{{ key|escape }}:{{ action.params[key]|escape }}{%- endfor %};{%- endfor %}">{{ item.name }}</a>
            {%- if item.children -%}
              <ul>
                {{ loop(item.children) }}
              </ul>
            {%- endif %}
          </li>
        {%- endfor %}
      </ul>
    </div>
    <div data-role="footer">
      <h4>Footer</h4>
    </div>
  </div>
</body>
</html>
